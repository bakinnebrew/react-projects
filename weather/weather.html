<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <title>Weather</title>
    <style>
        #weather-card{
            width: 75px;
            height: 75px;
            border-color:steelblue;
            border-style:solid;
            border-radius: 5px;   
            display: inline-block; 
            margin-right: 10px;   
        }

        body {
            text-align: center;
            color: black;
            font-family: sans-serif;
        }

        #weather-prop-temp{
            font-size: larger;
        }
    </style>
  </head>
  <body>
    <div id="app" />
    <script type="text/babel">

      class WeatherCard extends React.Component {

            constructor(props){
                super(props);
                this.state = {
                    city_name: "",
                    temperature: 0,
                    wind_speed: 0
                }
            }
          render(){
              return(
                  <div id="weather-card">
                    <h3> {this.props.city_name} </h3>
                        <div id="weather-prop"> {this.props.day_of_week} </div>
                        <div id="weather-prop-temp"> {this.props.temperature} </div>
                        <div id="weather-prop"> {this.props.wind_speed} </div>
                  </div>
              )
          }
      }


      class App extends React.Component {

            constructor(props){
                super(props);
                this.state = {
                    day_of_week: "",
                    search: "",
                    city: "",
                    forecast: "",
                    temperature: 0,

                }
            }
            componentDidMount() {
            this.getWeekday()
            }

        render() {
          return (
            <div>
                <h1> Weather App </h1>
                <input type="text" placeholder="e.g., Atlanta" onKeyPress={this.inputKeyPress} onChange={this.updateResponse} value={this.state.search}/>
                <h3 id="current-forecast"> Current Forecast: {this.state.forecast}</h3>
                <div>
                    <WeatherCard day_of_week={this.state.day_of_week} temperature={this.state.temperature} />
            
                </div>
            </div>
          );
        }

        inputKeyPress = (event) => {
            if(event.key === 'Enter'){
                const search = this.state.search;

                    fetch(`https://community-open-weather-map.p.rapidapi.com/weather?q=${search}&lang=null&units=imperial`, {
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-key": "e2fa911db7msh93dbbd7933d36a8p1ef276jsnf1cfb11fbcd8",
                        "x-rapidapi-host": "community-open-weather-map.p.rapidapi.com"
                    }
                })
                .then(response => {
                    return response.json()
                })
                .then(json => {
                    console.log('json', json)
                    console.log(json.main.temp)
                    this.setState({
                        temperature: Math.round(json.main.temp),
                        forecast: json.weather[0].main
                    })
                })
                .catch(err => {
                    console.error(err);
                    this.setState({
                        forecast: "No Results Found"
                    })
                })
            }
        }

        updateResponse = (event) => {
            this.setState({
                search: event.target.value
            });
        }

        getWeekday = () => {
            let d = new Date();
            let weekday = new Array(7);
            weekday[0] = "SUN";
            weekday[1] = "MON";
            weekday[2] = "TUES";
            weekday[3] = "WED";
            weekday[4] = "THUR";
            weekday[5] = "FRI";
            weekday[6] = "SAT";

            let n = weekday[d.getDay()];   
            this.setState({
                day_of_week: n
            })

        }
      
    }

      ReactDOM.render(<App />, document.querySelector("#app"));

    </script>
  </body>
</html>



